<!DOCTYPE html>
<html>
        <head>
                <title>Pengetesan Hardware & Software</title>
                <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<style>
@import url('https://fonts.googleapis.com/css2?family=Urbanist:wght@500&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Bellota+Text:wght@700&display=swap');
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 1,
  'wght' 700,
  'GRAD' 200,
  'opsz' 48
}
        #container {
                font-family: 'Urbanist', sans-serif;
        }
        #waktu {
                font-family: 'Urbanist', sans-serif;
        }
        button {
                font-family: 'Bellota Text', cursive;
                cursor:pointer; 
                border-radius: 800px; 
                background-color: #0fa3ff; 
                box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19); 
                padding: 10px 20px;
        }
        .recording {
      background-color: red;
    }
    .not-recording {
      background-color: green;
    }
</style>
        </head>
        <body>
                 <div id="online-content">
                 <video id="videoElement" autoplay></video>
                         <br></br>
                        <button onclick="startCamera()">Tes Kamera+Mikrofon Mu!</button>
                <button onclick="getLocation()">Tes Lokasi Mu!</button>
                         <button id="recordButton" class="not-recording" onclick="toggleRecording()">Tes Layar Mu!(WebRTC)</button>
                         <button style="cursor:pointer; border-radius: 800px; background-color: #008CBA; box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19); position: absolute; top: 0; right: 0; display: inline-block; padding: 5px 10px; margin-right: 5px;" onclick="refresh()" class="material-symbols-outlined">
refresh</button>
               <div id="container"></div>
    <div id="waktu"></div>
                </div>
  <script>
          function refresh() {
                  location.reload();
          }
    let mediaStream;
    let mediaRecorder;
    let recordedChunks = [];
    let isRecording = false;

    function toggleRecording() {
      if (!isRecording) {
        startRecording();
      } else {
        stopRecording();
      }
    }

    async function startRecording() {
      try {
        if (isDeviceSupported()) {
          mediaStream = await navigator.mediaDevices.getDisplayMedia({ audio: true, video: true });

          mediaRecorder = new MediaRecorder(mediaStream);
          mediaRecorder.addEventListener('dataavailable', event => {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          });

          mediaRecorder.start();
          isRecording = true;
          updateButtonState();
        } else {
          alert("Karena OS[Operating System/Sistem Operasi] Mu iOS/Android, Jadi Pengetesan Layar Gak Mendukung Di Perangkat Ini.");
        }
      } catch (error) {
        console.error(error);
        alert("Gagal Menangkap Layar : \n" + error.message);
      }
    }

    function stopRecording() {
      if (mediaRecorder && mediaStream) {
        mediaRecorder.stop();

        const blob = new Blob(recordedChunks, { type: 'video/mp4' });
        const videoURL = URL.createObjectURL(blob);
        const videoPlayer = document.createElement('video');
        videoPlayer.src = videoURL;
        videoPlayer.controls = true;
        document.body.appendChild(videoPlayer);

        isRecording = false;
        updateButtonState();

        // Hapus video pemutar setelah perekaman selesai
        videoPlayer.addEventListener('ended', () => {
          videoPlayer.remove();
          URL.revokeObjectURL(videoURL);
        });
      }
    }

    function updateButtonState() {
      const recordButton = document.getElementById('recordButton');
      if (isRecording) {
        recordButton.innerText = 'Stop Tes Layar';
        recordButton.classList.remove('not-recording');
        recordButton.classList.add('recording');
      } else {
        recordButton.innerText = 'Tes Layar Mu!(WebRTC)';
        recordButton.classList.remove('recording');
        recordButton.classList.add('not-recording');
      }
    }

    function isDeviceSupported() {
      const userAgent = navigator.userAgent.toLowerCase();
      const isAndroid = userAgent.includes("android");
      const isiOS = /(iphone|ipad|ipod|macintosh)/.test(userAgent);
      
      return !(isAndroid || isiOS);
    }

          var cameraMicPressed = false;

                    function startCamera() {
                        if (cameraMicPressed) {
                            alert("Tombol Untuk Tes Kamera Cuman Ditekan Sekali!(Reload Website Untuk Menekannya Lagi)");
                            return;
                        }
                        
                        cameraMicPressed = true;

                        // Minta izin akses kamera
                        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                            .then(function (stream) {
                                var video = document.getElementById('videoElement');
                                video.srcObject = stream;
                                video.play();
                            })
                            .catch(function (error) {
                                alert('Gagal Mengakses Kamera : \n' + error);
                                console.error(error);
                                cameraMicPressed = false; // Reset ke false jika ada error
                            });
                    }

                    function getLocation() {
                        if (navigator.geolocation) {
                            navigator.geolocation.watchPosition(showPosition);
                        } else {
                            alert('Sepertinya Browser Mu Ini Gak Mendukung \"GeoLocation\".');
                            console.warn("GEOLOCATORERROR : Your browser doesnt support GEOLOCATION or your browser blocked this website to using LOCATION.ACCESS");
                        }
                    }

                    function showPosition(position) {
                        var container = document.getElementById('container');
                        var waktuElement = document.getElementById('waktu');
                        var waktu = getCurrentDateTime();
                        var waaaktu = "Tanggal & Waktu : " + waktu;

                        container.innerText = "\n Garis Lintang(Latitude) : " + position.coords.latitude + "\n Garis Bujur(Longitude) : " + position.coords.accuracy + "\n Akurasi Posisi(The accuracy of position) : " + position.coords.accuracy;
                        waktuElement.innerText = waaaktu;

                        setInterval(function() {
                            waktu = getCurrentDateTime();
                            waaaktu = "Tanggal & Waktu : " + waktu;
                            waktuElement.innerText = waaaktu;
                        }, 1000);
                    }

                    function getCurrentDateTime() {
                        var waktu = new Date();
                        var tahun = waktu.getFullYear();
                        var bulan = waktu.toLocaleDateString('id-ID', { month: 'long' });
                        var tanggal = waktu.getDate();
                        var hari = waktu.toLocaleDateString('id-ID', { weekday: 'long' });
                        var jam = waktu.getHours();
                        var menit = waktu.getMinutes();
                        var detik = waktu.getSeconds();

                        // Tambahkan angka 0 di depan jam, menit, dan detik jika nilainya kurang dari 10
                        jam = (jam < 10 ? "0" : "") + jam;
                        menit = (menit < 10 ? "0" : "") + menit;
                        detik = (detik < 10 ? "0" : "") + detik;

                        var waktuString = hari + ', ' + tanggal + ' ' + bulan + ' ' + tahun + ' ' + jam + ':' + menit + ':' + detik;

                        return waktuString;
                    }
                </script>
        </body>
</html>
