<!DOCTYPE html>
<html>
        <head>
                <title>Pengetesan Hardware, Software & Browser</title>
                <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<style>
@import url('https://fonts.googleapis.com/css2?family=Urbanist:wght@500&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Bellota+Text:wght@700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Saira+Condensed:wght@600&display=swap');
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 1,
  'wght' 700,
  'GRAD' 200,
  'opsz' 48
}
        #container {
                font-family: 'Urbanist', sans-serif;
        }
        #waktu {
                font-family: 'Urbanist', sans-serif;
        }
        button {
                font-family: 'Bellota Text', cursive;
                cursor:pointer; 
                border-radius: 800px; 
                background-color: #0fa3ff; 
                box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19); 
                padding: 10px 20px;
        }
        .recording {
      background-color: red;
    }
    .not-recording {
      background-color: green;
    }
        #textElement {
                font-family: 'Saira Condensed', sans-serif;
        }
</style>
        </head>
        <body>
                 <div id="online-content">
                         <video id="videoElement" autoplay></video>
                         <br>
  <button onclick="getCamNMic()"> Tes Kamera+Mikrofon Mu!</button>
 <button onclick="getLocation()">Tes Lokasi Mu!</button>
                         <button id="recordButton" class="not-recording" onclick="toggleRecording()">Tes Layar Mu!(Gak Pakek WebRTC Karena Aku Noob :v)</button>
                         <button style="cursor:pointer; border-radius: 800px; background-color: #008CBA; box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19); position: absolute; top: 0; right: 0; display: inline-block; padding: 5px 10px; margin-right: 5px; z-index: 1;" onclick="refresh()" class="material-symbols-outlined">
refresh</button>
                         <a href="https://boring-websites.netlify.app" target="_parent">
    <button style="cursor:pointer; border-radius: 800px; background-color: blue; box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19); position: absolute; top: 0; right: 50px; display: inline-block; padding: 5px 10px; margin-right: 5px; z-index: 1;" class="material-symbols-outlined">arrow_back_ios</button>
                         </a>
                         <div id="container"></div>
    <div id="waktu"></div>
                         <br>
                         <button onclick="playYouTubeVideo()">Tes &ltiframe&gt Di Browser Mu! (Sumber Aksi : Youtube)</button>
                         </div>
                <br>
                <div id="textElement"></div>
                <br>
                <button onclick="requestNotificationPermission()">Tes Notifikasi Mu!(Service-Worker, Notification API & Push API)</button>
  <script>
          if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('service-worker.js').then(function (registration) {
                    alert("Service-Worker Telah Berhasil Didaftarkan : " + registration.scope);
                    console.log("service-worker registered successfully : " + registration.scope);
                }, function (err) {
                    console.error("service-worker registered failed : " + err);
                });
            });
        } else {
            alert("Browser Mu Tidak Mendukung Service Worker.");
            console.warn("Browser Doesn't Support [service-worker]");
        }

        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission()
                    .then(function (permission) {
                        if (permission === 'granted') {
                            alert("Notifikasi Diizinkan!");
                            console.log("Diizinkan.");
                            sendNotification();
                        } else {
                            alert("Notifikasi Ditolak!");
                            console.warn("Ditolak.");
                        }
                    });
            } else {
                alert("Browser Mu Tidak Mendukung API Notifikasi");
                console.warn("Browser Doesn't Support NOTIFICATION.API");
            }
        }

function sendNotification() {
  if ('serviceWorker' in navigator && 'PushManager' in window) {
    var notificationTitle = prompt("Masukkan Judul Notifikasi : ");
    var notificationText = prompt("Masukkan Teks Notifikasi : ");
    var action1Title = prompt("Masukkan Nama Untuk Tombol 1 : ");
    var action2Title = prompt("Masukkan Nama Untuk Tombol 2 : ");
    
    if (notificationTitle && notificationText && action1Title && action2Title) {
      navigator.serviceWorker.ready
        .then(function (registration) {
          const options = {
            body: notificationText,
            icon: 'notifications_FILL1_wght700_GRAD200_opsz48.png',
            actions: [
              { action: 'action-1', title: action1Title },
              { action: 'action-2', title: action2Title }
            ]
          };
          registration.showNotification(notificationTitle, options);
        })
        .catch(function (error) {
          alert("Terjadi Kesalahan Saat Mengirim Notifikasi : " + error);
          console.error(error);
        });
    } else {
      alert("Masukkan Input Yang Valid!");
    }
  } else {
    alert("Browser Mu Tidak Mendukung API Notifikasi Atau Service Worker.");
    console.error("Browser Doesn't Support NOTIFICATION.API Or [service-worker].");
  }
}

        navigator.serviceWorker.onmessage = event => {
            if (event.data.action === 'tampilkan_teks') {
                const teksElement = document.getElementById('textElement');
                teksElement.innerHTML = "Judul Notifikasi : " + `${event.data.judul}` + "<br>Pesan Notifikasi : " + `${event.data.isi}` + "<br>Tombol Yang Diklik : " + `${event.data.teks}` + "<br>Ikon Notifikasi : <i class=" + '"material-symbols-outlined"' + ">notifications</i>";
            }
        };
function extractVideoIDFromURL(url) {
  // Regex untuk mendeteksi Video ID dari URL YouTube (termasuk URL pendek)
  const regex = /(?:youtu\.be\/|youtube(?:-nocookie)?\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w-]{11})/;
  const match = url.match(regex);
  return match ? match[1] : null;
}

function isValidVideoID(input) {
  // Regex untuk mendeteksi VIDEO_ID YouTube yang valid (11 karakter alfanumerik)
  const regex = /^[a-zA-Z0-9_-]{11}$/;
  return regex.test(input);
}

function playYouTubeVideo() {
  const userInput = prompt("Masukkan URL/Link Video YouTube Untuk Mengetes /<iframe/> Browser Mu :");

  if (userInput === null) {
    alert("Kamu Membatalkan Tes.");
    console.log('Canceled.');
    return;
  }

  // Ekstrak Video ID dari URL
  const videoID = extractVideoIDFromURL(userInput);

  if (videoID && isValidVideoID(videoID)) {
    // Jika Video ID valid, sematkan video YouTube menggunakan iframe
    const videoIframe = document.createElement('iframe');
    videoIframe.width = "560";
    videoIframe.height = "315";
    videoIframe.src = `https://www.youtube.com/embed/${videoID}`;
    videoIframe.frameBorder = "0";
    videoIframe.allow = "autoplay; encrypted-media";
    videoIframe.allowFullscreen = true;

    document.body.appendChild(videoIframe);
  } else {
    alert("URL/Link Youtube Yang Kamu Berikan Tidak Valid Atau Tidak Mengandung ID Video YouTube!");
    console.error('Invalid URL/Link Youtube.');
  }
          }
          
          function refresh() {
                  location.reload();
          }
    let mediaStream;
    let mediaRecorder;
    let recordedChunks = [];
    let isRecording = false;

    function toggleRecording() {
      if (!isRecording) {
        startRecording();
      } else {
        stopRecording();
      }
    }

    async function startRecording() {
      try {
        if (isDeviceSupported()) {
          mediaStream = await navigator.mediaDevices.getDisplayMedia({ audio: true, video: true });

          mediaRecorder = new MediaRecorder(mediaStream);
          mediaRecorder.addEventListener('dataavailable', event => {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          });

          mediaRecorder.start();
          isRecording = true;
          updateButtonState();
        } else {
          alert("Karena OS[Operating System/Sistem Operasi] Mu iOS/Android, Jadi Pengetesan Layar Gak Mendukung Di Perangkat Ini.");
        }
      } catch (error) {
        console.error(error);
        alert("Gagal Menangkap Layar : \n" + error.message);
      }
    }

    function stopRecording() {
      if (mediaRecorder && mediaStream) {
        mediaRecorder.stop();

        const blob = new Blob(recordedChunks, { type: 'video/mp4' });
        const videoURL = URL.createObjectURL(blob);
        const videoPlayer = document.createElement('video');
        videoPlayer.src = videoURL;
        videoPlayer.controls = true;
        document.body.appendChild(videoPlayer);

        isRecording = false;
        updateButtonState();

        // Hapus video pemutar setelah perekaman selesai
        videoPlayer.addEventListener('ended', () => {
          videoPlayer.remove();
          URL.revokeObjectURL(videoURL);
        });
      }
    }

    function updateButtonState() {
      const recordButton = document.getElementById('recordButton');
      if (isRecording) {
        recordButton.innerText = 'Stop Tes Layar';
        recordButton.classList.remove('not-recording');
        recordButton.classList.add('recording');
      } else {
        recordButton.innerText = 'Tes Layar Mu!(WebRTC)';
        recordButton.classList.remove('recording');
        recordButton.classList.add('not-recording');
      }
    }

    function isDeviceSupported() {
      const userAgent = navigator.userAgent.toLowerCase();
      const isAndroid = userAgent.includes("android");
      const isiOS = /(iphone|ipad|ipod|macintosh)/.test(userAgent);
      
      return !(isAndroid || isiOS);
    }
            var cameraMicPressed = false;

                    function getCamNMic() {
                        if (cameraMicPressed) {
                            alert("Tombol Untuk Tes Kamera Cuman Ditekan Sekali!(Reload Website Untuk Menekannya Lagi)");
                            return;
                        }
                        
                        cameraMicPressed = true;

                        // Minta izin akses kamera
                        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                            .then(function (stream) {
                                var video = document.getElementById('videoElement');
                                video.srcObject = stream;
                                video.play();
                            })
                            .catch(function (error) {
                                alert('Gagal Mengakses Kamera : \n' + error);
                                console.error(error);
                                cameraMicPressed = false; // Reset ke false jika ada error
                            });
                    }

                    function getLocation() {
                        if (navigator.geolocation) {
                            navigator.geolocation.watchPosition(showPosition);
                        } else {
                            alert('Sepertinya Browser Mu Ini Gak Mendukung \"GeoLocation\".');
                            console.warn("GEOLOCATORERROR : Your browser doesnt support GEOLOCATION or your browser blocked this website to using LOCATION.ACCESS");
                        }
                    }

                    function showPosition(position) {
                        var container = document.getElementById('container');
                        var waktuElement = document.getElementById('waktu');
                        var waktu = getCurrentDateTime();
                        var waaaktu = "Tanggal & Waktu : " + waktu;

                        container.innerText = "\n Garis Lintang(Latitude) : " + position.coords.latitude + "\n Garis Bujur(Longitude) : " + position.coords.accuracy + "\n Akurasi Posisi(The accuracy of position) : " + position.coords.accuracy;
                        waktuElement.innerText = waaaktu;

                        setInterval(function() {
                            waktu = getCurrentDateTime();
                            waaaktu = "Tanggal & Waktu : " + waktu;
                            waktuElement.innerText = waaaktu;
                        }, 1000);
                    }

                    function getCurrentDateTime() {
                        var waktu = new Date();
                        var tahun = waktu.getFullYear();
                        var bulan = waktu.toLocaleDateString('id-ID', { month: 'long' });
                        var tanggal = waktu.getDate();
                        var hari = waktu.toLocaleDateString('id-ID', { weekday: 'long' });
                        var jam = waktu.getHours();
                        var menit = waktu.getMinutes();
                        var detik = waktu.getSeconds();

                        // Tambahkan angka 0 di depan jam, menit, dan detik jika nilainya kurang dari 10
                        jam = (jam < 10 ? "0" : "") + jam;
                        menit = (menit < 10 ? "0" : "") + menit;
                        detik = (detik < 10 ? "0" : "") + detik;

                        var waktuString = hari + ', ' + tanggal + ' ' + bulan + ' ' + tahun + ' ' + jam + ':' + menit + ':' + detik;

                        return waktuString;
                    }
                </script>
        </body>
</html>
